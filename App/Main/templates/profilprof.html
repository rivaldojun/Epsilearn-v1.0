{% extends "base.html" %}

{% block content %} 
<style>
  body {
    background-color: #f5f5f5;
  }
  /* Style for the stars */
.stars {
  font-size: 24px;
  cursor: pointer;
}

/* Style for the gold stars */
.golds {
  color: gold;
}

/* Style pour le message de succès */
.vote-effectue {
  color: green;
  font-size: 14px;
}

/* Style pour le message d'erreur */
.deja-vote {
  color: red;
  font-size: 14px;
}


/*Dialog Styles*/
dialog {
  padding: 1rem 3rem;
  background: white;
  max-width: 400px;
  padding-top: 2rem;
  border-radius: 20px;
  border: 0;
  box-shadow: 0 5px 30px 0 rgba(0, 0, 0, 0.1);
  -webkit-animation: fadeIn 1s ease both;
          animation: fadeIn 1s ease both;
}
dialog::-webkit-backdrop {
  -webkit-animation: fadeIn 1s ease both;
          animation: fadeIn 1s ease both;
  background: rgba(255, 255, 255, 0.4);
  z-index: 2;
  -webkit-backdrop-filter: blur(20px);
          backdrop-filter: blur(20px);
}
dialog::backdrop {
  -webkit-animation: fadeIn 1s ease both;
          animation: fadeIn 1s ease both;
  background: rgba(255, 255, 255, 0.4);
  z-index: 2;
  -webkit-backdrop-filter: blur(20px);
          backdrop-filter: blur(20px);
}
dialog .x {
  filter: grayscale(1);
  border: none;
  background: none;
  position: absolute;
  top: 15px;
  right: 10px;
  transition: ease filter, transform 0.3s;
  cursor: pointer;
  transform-origin: center;
}
dialog .x:hover {
  filter: grayscale(0);
  transform: scale(1.1);
}
dialog h2 {
  font-weight: 600;
  font-size: 2rem;
  padding-bottom: 1rem;
}
dialog p {
  font-size: 1rem;
  line-height: 1.3rem;
  padding: 0.5rem 0;
}
dialog p a:visited {
  color: rgb(var(--vs-primary));
}

/*General Styles*/


button.primary {
  display: inline-block;
  font-size: 0.8rem;
  color: #fff !important;
  background: rgb(var(--vs-primary)/100%);
  padding: 13px 25px;
  border-radius: 17px;
  transition: background-color 0.1s ease;
  box-sizing: border-box;
  transition: all 0.25s ease;
  border: 0;
  cursor: pointer;
  box-shadow: 0 10px 20px -10px rgb(var(--vs-primary)/50%);
}
button.primary:hover {
  box-shadow: 0 20px 20px -10px rgb(var(--vs-primary)/50%);
  transform: translateY(-5px);
}

@-webkit-keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}
  /* Add more CSS styling as needed */
</style>
<div>
  <dialog id="dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="noteModalLabel">Noter le professeur</h5>
      </div>
      <div class="contenu-dynamic modal-body justify-content-center d-flex">
        <div class="ratings">
          <span class="stars" data-value="1">&#9733;</span>
          <span class="stars" data-value="2">&#9733;</span>
          <span class="stars" data-value="3">&#9733;</span>
          <span class="stars" data-value="4">&#9733;</span>
          <span class="stars" data-value="5">&#9733;</span>
        </div>
        <!-- Hidden input field for the selected rating -->
        <input type="hidden" id="ratings" name="rating">
      </div>
        <button type="button" class="btn btn-primary" id="submitRating">Soumettre</button>
    </div>
    <button onclick="window.dialog.close();" aria-label="close" class="x">❌</button>
  </dialog>
</div>

<div class="container" style="margin-top: 100px;">
  <div class="row">
    <div class="col-md-8">
      <!-- Biography Card -->
      <div class="card mb-4" style="font-family: 'Kanit';">
        <div class="card-header  text-center font-weight-bold" style="background-color: blue;color: white;">BIOGRAPHIE</div>
        <div class="card-body" style="margin-left: 30%; word-wrap: break-word;">
          <p class="m-0">{{ bio }}</p>
        </div>
        <div class="card-body">
          <div class="profile-picture" style="height: 120px; margin-top: -50px;">
            <img src="../{{ photo }}" alt="Photo de profil" class="img-fluid" style="height: 100px; width: 100px; border-radius: 50%; overflow: hidden;">
          </div>
          <div class="bio">
            <p style="color: black; font-weight: bolder;">{{ nom }} {{ Prenom }}</p>
          </div>
        </div>
      </div>

      <!-- Rating Card -->
      <div class="card mb-4">
        <div class="card-header  text-center font-weight-bold" style="color: rgb(249, 249, 249);background-color: blue;">NOTE</div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-12">
              <p style="text-align:center;text-decoration:underline">Note du prof</p>
              <div id="rating" class="rating text-center">
              </div>
            </div>
          </div>
        </div>
        <div class="card-footer">
            <p style='text-align:center'>Voulez-vous noter ce prof ?</p>
            <a href="#" class="d-flex justify-content-center align-items-center" onclick="window.dialog.showModal();">Noter le prof</a>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card mb-4" style="font-family: 'Kanit';">
        <div class="card-header  text-center font-weight-bold" style="background-color: blue;color: white;">INFORMATIONS</div>
        <div class="card-body mt-3" style="height: min-content;">
          <p style="color: black;"><strong>Discipline(s) enseignée(s):</strong> {{ Discipline }}</p>
          <p style="color: black;"><strong>Formation:</strong> {{ Formation }}</p>
          <p style="color: black;"><strong>Niveau d'étude:</strong> {{ Niveau }}</p>
          <p style="color: black;"><strong>Nationalité:</strong> {{ nat }}</p>
          <p style="color: black;"><strong>Dernier diplôme obtenu:</strong> {{ Diplome }}</p>
        </div>
      </div>
      <div class="card" style="font-family: 'Kanit';">
        <div class="card-header  text-center font-weight-bold" style="background-color: blue;color: white;">STATISTIQUES</div>
        <div class="card-body" style="height: min-content;">
          <p style="color: black;"><strong>Nombre de cours:</strong> </p>
        </div>
      </div>
    </div>
  </div>

  {% if user_type == "etudiant" %}
  <form method="POST" action="#">
    <div class="comment-form">
      <textarea name="commentaire" style="width: 66%; height: 100px; resize: none;border: none;border-radius: 10px;" placeholder="Commenter..."></textarea><br>
      <button class="btn btn" style="background-color: blue;"><i class="fa fa-paper-plane" style="color: white;"></i></button>
    </div>
  </form>
  {% endif %}

  <br>
  <div style="font-family: 'Kanit'; font-size: 18px;color: blue;">Commentaires</div>
  <br>
  <div id="comment-container">
    {% for commentaire in commentaires %}
    <div class="commentaire" style="background-color: white; border-radius: 10px; padding: 10px 20px 20px 20px;width: 66%;margin-bottom: 10px;" data-comment-id="{{ commentaire.id }}">
      <div class="auteur"><strong>{{ commentaire.commentateurs.nom }} {{ commentaire.commentateurs.prenom }}</strong></div>
      <div class="contenu">{{ commentaire.commentaire }}</div>
    </div>
    {% endfor %}
    <button id="load-more" style="background-color: transparent;color: blue;text-decoration: underline;border: none;">Voir plus</button>
  </div>
  
</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.0.7/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- Rest of your content goes here -->
<script>
const commentContainer = document.getElementById("comment-container");
  const loadMoreButton = document.getElementById("load-more");
  const comments = document.querySelectorAll(".commentaire");
  let visibleComments = 3;
  const commentsPerLoad = 3;

  loadMoreButton.addEventListener("click", function () {
    for (let i = visibleComments; i < visibleComments + commentsPerLoad && i < comments.length; i++) {
      comments[i].style.display = "block";
    }
    visibleComments += commentsPerLoad;

    // Vérifie si tous les commentaires ont été affichés
    if (visibleComments >= comments.length) {
      loadMoreButton.style.display = "none";
    }
  });

  // Cache les commentaires initialement
  for (let i = visibleComments; i < comments.length; i++) {
    comments[i].style.display = "none";
  }

  if (comments.length <= visibleComments) {
    loadMoreButton.style.display = "none";
  }



     const ratingValue =`{{ note }} `;
    function generateRating(rating) {
  const ratingContainer = document.getElementById('rating');
  ratingContainer.innerHTML = '';

  for (let i = 0; i < 5; i++) {
    const star = document.createElement('span');
    star.classList.add('star');

    if (i < rating) {
      star.style.color = 'gold';
    } else {
      star.style.color = 'black';
    }

    star.innerHTML = '&#9733;';
    ratingContainer.appendChild(star);
  }
}

// Exemple d'utilisation avec un rating de 3
generateRating(ratingValue);


// Fonction pour générer la liste déroulante des commentaires
function genererListeDeroulante() {
  const select = document.createElement("select");

  commentaires.forEach((commentaire, index) => {
    const option = document.createElement("option");
    option.value = index;
    option.textContent = commentaire.auteur;
    select.appendChild(option);
  });

  select.addEventListener("change", afficherCommentaire);

  return select;
}

// Fonction pour afficher le commentaire sélectionné
function afficherCommentaire(event) {
  const commentaireIndex = event.target.value;
  const commentaire = commentaires[commentaireIndex];

  const commentairesDiv = document.getElementById("commentaires");
  commentairesDiv.textContent = commentaire.commentaire;
}

// Function to handle star clicks
document.querySelectorAll('.stars').forEach(star => {
  star.addEventListener('click', event => {
    const value = parseInt(event.target.getAttribute('data-value'));
    document.querySelectorAll('.stars').forEach(star => {
      const starValue = parseInt(star.getAttribute('data-value'));
      star.classList.toggle('golds', starValue <= value);
    });
    document.getElementById('rating').value = value;
  });
});

// Fonction pour gérer le clic sur le bouton de soumission
document.getElementById('submitRating').addEventListener('click', () => {
  const rating = document.getElementById('rating').value;
  const userId = "{{ current_user.id }}";
  const profId = "{{ prof_id }}";
  
  // Construction de l'objet de données à envoyer
  const data = {
    rating: rating,
    userId: userId,
    profId: profId
  };

  // Envoi de la requête AJAX
  $.ajax({
    type: "POST",
    url: `/submit_rating/${userId}/${profId}`,
    contentType: "application/json",
    data: JSON.stringify(data),
    success: function(response) {
      if (response === "deja vote") {
        // Si la réponse est "deja vote", afficher le message correspondant dans le modal
        $('.contenu-dynamic').html("<p class='deja-vote'>Vous avez déjà voté</p>");
      } else {
        alert('mdr')
        // Si la réponse est différente de "deja vote", afficher le message "Vote effectué"
        $('.contenu-dynamic').html("<p class='vote-effectue'>Vote effectué</p>");
        // Ajouter une icône appropriée pour indiquer que le vote a été effectué
        $('.contenu-dynamic').append("<i class='fas fa-check-circle'></i>");
      }
    },
    error: function(xhr, status, error) {
      console.error('Erreur lors de la soumission de la note.');
    }
  });
});



</script>
{% endblock %}