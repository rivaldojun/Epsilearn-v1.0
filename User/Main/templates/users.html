{% extends "base.html" %}

{% block title %}Messagerie | Epsilearn{% endblock %}

{% block content %}
    <style>
         body {
      background-color: #f5f5f5;
    
    }

        .style {
            max-width: 600px;
            margin: 0 auto;
            border: 2px solid #2a2d33;
            border-radius: 5px;
            background-color: transparent;
            padding: 20px;
        
        }

        h1 {
            text-align: center;
        }

        #search {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            margin-bottom: 15px;
        }

        /* Define a fixed height for the user list panel */
        #user-list-panel {
            max-height: 320px; /* Change this to your desired fixed height */
            overflow-y: auto; /* Enable vertical scroll when content overflows */
        }

        .list-group-item {
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .list-group-item:hover {
            background-color: #f8f9fa;
        }
        /* Style pour la liste des messages reçus */
ul {
    list-style: none; /* Supprimez le point avant les éléments de la liste */
}
.msglist{
background-color: rgb(255, 255, 255);
}

.msglist:hover{
cursor: pointer;

}

    </style>
    <div style="height: 10px;"></div>
    <div class="container style mt-4">
        <h1 style="color: rgb(0, 0, 0);">Utilisateurs</h1>
        
        <!-- Search bar -->
        <div class="form-group">
            <input type="text" class="form-control" id="search" placeholder="Search by name">
        </div>
        <!-- Add an ID to the user list panel to apply the fixed height and scroll -->
        <ul id="user-list-panel" class="list-group">
            {% for us in users %}
                <li class="list-group-item" style="background-color: blue;color: white;">
                    <a href="{{ url_for('Main.conversation', user_id=us.id) }}" style="text-decoration: none;color: white;">{{ us.nom }} {{ us.prenom }}</a>
                </li>
            {% endfor %}
        </ul>
    </div>
    <br>
    <br>
    <div class="container">
        <h3 style="text-align: center;">Messages</h3>
        <br>
        <ul>
            {% for autre_utilisateur, dernier_message in dernier_messages.items() %}
            <li class="msglist" style="padding: 10px;padding-bottom: 30px;" onclick="window.location.href='{{ url_for('Main.conversation', user_id=autre_utilisateur.id) }}';">
                {% if dernier_message %}
                <span style="font-weight: bold;color: blue;font-size: 20px;">{{ autre_utilisateur.nom }} {{ autre_utilisateur.prenom }}</span>
                <br>
                <span style="color: rgb(0, 0, 0);">{{ dernier_message.contenu }}</span>
                <br>
                 <span style="float: right;opacity: 0.5;margin-bottom: 10px;">{{ dernier_message.date_envoi.strftime('%Y-%m-%d %H:%M:%S') }}</span>
                {% endif %}
            </li>
            {% endfor %}
        </ul>
    </div>

{% endblock %}


<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.1/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
<script>
    // Filter the user list based on search input
    $(document).ready(function(){
        $('#search').on('keyup', function(){
            var value = $(this).val().toLowerCase();
            $('#user-list-panel li').filter(function(){
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
            });
        });

    });
</script>

